#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_QUESTIONS 5

typedef struct {
    char question[100];
    char answer[100];
} Question;

int main(int argc, char *argv[]) {
    char *filename = "database/login.bin";
    FILE *fp;
    char username[20], password[20];
    int i, score = 0;

    Question questions[MAX_QUESTIONS] = {
        {"Siapakah presiden pertama Indonesia?", "Soekarno"},
        {"Siapakah penemu bola lampu?", "Thomas Alva Edison"},
        {"Siapakah penemu telepon?", "Alexander Graham Bell"},
        {"Berapa 4 x 20 ?", "80"},
        {"Siapakah penemu televisi?", "John Logie Baird"}
    };

    fp = fopen(filename, "rb");
    if (fp == NULL) {
        printf("Akun belum terdaftar.\n");
        printf("Silakan daftar terlebih dahulu.\n");
        printf("Masukkan username baru: ");
        fgets(username, 20, stdin);
        // hapus karakter newline pada akhir string input
        username[strcspn(username, "\n")] = '\0';
        printf("Masukkan password baru: ");
        fgets(password, 20, stdin);
        // hapus karakter newline pada akhir string input
        password[strcspn(password, "\n")] = '\0';

        fclose(fp);
        fp = fopen(filename, "wb");
        if (fp == NULL) {
            printf("Error opening file %s\n", filename);
            return 1;
        }

        fwrite(username, sizeof(username), 1, fp);
        fwrite(password, sizeof(password), 1, fp);
        printf("Akun berhasil terdaftar!\n");

        fclose(fp);
        return 0;
    }

    printf("Masukkan username: ");
    fgets(username, 20, stdin);
    // hapus karakter newline pada akhir string input
    username[strcspn(username, "\n")] = '\0';
    printf("Masukkan password: ");
    fgets(password, 20, stdin);
    // hapus karakter newline pada akhir string input
    password[strcspn(password, "\n")] = '\0';

    while (fread(username, sizeof(username), 1, fp)) {
        fread(password, sizeof(password), 1, fp);
        if (strcmp(username, argv[1]) == 0 && strcmp(password, argv[2]) == 0) {
            printf("Login berhasil!\n");
            break;
        }
    }

    if (feof(fp)) {
        printf("Login gagal!\n");
        printf("Silakan gunakan CLA untuk login.\n");
        printf("Usage: %s <username> <password>\n", argv[0]);
        fclose(fp);
        return 1;
    }

    fclose(fp);

    for (i = 0; i < MAX_QUESTIONS; i++) {
        char answer[100];
        printf("%d. %s\n", i + 1, questions[i].question);
        fgets(answer, 100, stdin);
        // hapus karakter newline pada akhir string input
        answer[strcspn(answer, "\n")] = '\0';
        if (strcmp(answer, questions[i].answer) == 0) {
            score++;
            printf("Jawaban benar!\n");
        } else {
            printf("Jawaban salah!\n");
        }
    }

    printf("Poin akhir Anda: %d\n", score);

    return 0;
}
